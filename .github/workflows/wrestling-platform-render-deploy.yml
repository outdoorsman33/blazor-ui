name: Wrestling Platform Render Deploy

on:
  workflow_dispatch:
  push:
    branches: [ "master", "main" ]
    paths:
      - "sample-applications/wrestling-platform/**"
      - ".github/workflows/wrestling-platform-render-deploy.yml"

jobs:
  deploy-staging:
    if: ${{ secrets.RENDER_STAGING_API_DEPLOY_HOOK_URL != '' && secrets.RENDER_STAGING_WEB_DEPLOY_HOOK_URL != '' }}
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - name: Trigger API staging deploy
        run: curl -fsSL -X POST "${{ secrets.RENDER_STAGING_API_DEPLOY_HOOK_URL }}"

      - name: Trigger Web staging deploy
        run: curl -fsSL -X POST "${{ secrets.RENDER_STAGING_WEB_DEPLOY_HOOK_URL }}"

  deploy-production:
    needs: [deploy-staging]
    if: ${{ always() && secrets.RENDER_API_DEPLOY_HOOK_URL != '' && secrets.RENDER_WEB_DEPLOY_HOOK_URL != '' }}
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Trigger API production deploy
        run: curl -fsSL -X POST "${{ secrets.RENDER_API_DEPLOY_HOOK_URL }}"

      - name: Trigger Web production deploy
        run: curl -fsSL -X POST "${{ secrets.RENDER_WEB_DEPLOY_HOOK_URL }}"

