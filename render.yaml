services:
  - type: web
    name: wrestling-platform-api
    runtime: docker
    rootDir: sample-applications/wrestling-platform
    dockerfilePath: ./src/WrestlingPlatform.Api/Dockerfile
    dockerContext: .
    region: ohio
    plan: free
    autoDeploy: true
    healthCheckPath: /healthz
    buildFilter:
      paths:
        - sample-applications/wrestling-platform/**
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: Database__Provider
        value: Postgres
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: wrestling-platform-db
          property: connectionString
      - key: Jwt__Issuer
        value: PinPointArena.Production
      - key: Jwt__Audience
        value: PinPointArenaClients.Production
      - key: Jwt__SigningKey
        generateValue: true
      - key: Jwt__AccessTokenMinutes
        value: "30"
      - key: Jwt__RefreshTokenDays
        value: "14"
      - key: Payments__ProviderMode
        value: Mock
      - key: Payments__WebhookSignatureToleranceSeconds
        value: "300"
      - key: Payments__WebhookProcessing__PollIntervalSeconds
        value: "10"
      - key: Payments__WebhookProcessing__BatchSize
        value: "50"
      - key: Payments__WebhookProcessing__MaxAttempts
        value: "20"
      - key: Payments__WebhookProcessing__RetryWindowMinutes
        value: "90"
      - key: Payments__StripeSecretKey
        sync: false
      - key: Payments__StripeWebhookSecret
        sync: false
      - key: Notifications__ProviderMode
        value: Mock
      - key: Notifications__Twilio__AccountSid
        sync: false
      - key: Notifications__Twilio__AuthToken
        sync: false
      - key: Notifications__Twilio__FromNumber
        sync: false
      - key: Notifications__SendGrid__ApiKey
        sync: false
      - key: Notifications__SendGrid__FromEmail
        sync: false
      - key: Notifications__SendGrid__FromName
        value: PinPoint Arena
      - key: MediaPipeline__StorageMode
        value: Local
      - key: MediaPipeline__WorkingDirectory
        value: /tmp/media-pipeline
      - key: MediaPipeline__PublicBaseUrl
        value: https://media.pinpointarena.local
      - key: MediaPipeline__RetentionDays
        value: "120"
      - key: MediaPipeline__AiProvider
        value: RuleBased
      - key: MediaPipeline__OpenAiModel
        value: gpt-4.1-mini
      - key: MediaPipeline__S3Bucket
        sync: false
      - key: MediaPipeline__S3Region
        sync: false
      - key: MediaPipeline__S3ServiceUrl
        sync: false
      - key: MediaPipeline__S3AccessKeyId
        sync: false
      - key: MediaPipeline__S3SecretAccessKey
        sync: false
      - key: MediaPipeline__OpenAiApiKey
        sync: false
      - key: Security__Audit__FilePath
        value: /tmp/security/audit-log.jsonl
      - key: Security__Mfa__StoreFilePath
        value: /tmp/security/mfa-store.json
      - key: OTEL_EXPORTER_OTLP_ENDPOINT
        sync: false

  - type: web
    name: wrestling-platform-web
    runtime: docker
    rootDir: sample-applications/wrestling-platform
    dockerfilePath: ./src/WrestlingPlatform.Web/Dockerfile
    dockerContext: .
    region: ohio
    plan: free
    autoDeploy: true
    healthCheckPath: /healthz
    buildFilter:
      paths:
        - sample-applications/wrestling-platform/**
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: Api__BaseUrl
        value: https://wrestling-platform-api.onrender.com

databases:
  - name: wrestling-platform-db
    region: ohio
    plan: free
    databaseName: wrestling_platform
    user: wrestling_app
    postgresMajorVersion: "17"
    ipAllowList: []


